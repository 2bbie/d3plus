<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link href="../../d3plus.css" rel="stylesheet" type="text/css">
  <style>

  body {
    margin: 0px;
  }
  
  div#viz {
    width: 100%;
    height: 100%;
  }

  </style>
  
</head>
<body>

<div id="viz">Test</div>

<script src="../../lib/d3.js"></script>

<script src="../../src/general.js"></script>
<script src="../../src/public.js"></script>
<script src="../../src/viz.js"></script>

<script src="../../src/apps/network.js"></script>

<script src="../../src/data/analyze.js"></script>
<script src="../../src/data/color.js"></script>
<script src="../../src/data/fetch.js"></script>
<script src="../../src/data/filter.js"></script>
<script src="../../src/data/format.js"></script>
<script src="../../src/data/nest.js"></script>

<script src="../../src/shapes/area.js"></script>
<script src="../../src/shapes/color.js"></script>
<script src="../../src/shapes/coordinates.js"></script>
<script src="../../src/shapes/donut.js"></script>
<script src="../../src/shapes/draw.js"></script>
<script src="../../src/shapes/fill.js"></script>
<script src="../../src/shapes/labels.js"></script>
<script src="../../src/shapes/line.js"></script>
<script src="../../src/shapes/links.js"></script>
<script src="../../src/shapes/rect.js"></script>
<script src="../../src/shapes/style.js"></script>

<script src="../../src/styles/default.js"></script>

<script src="../../src/tooltip/app.js"></script>
<script src="../../src/tooltip/arrow.js"></script>
<script src="../../src/tooltip/create.js"></script>
<script src="../../src/tooltip/data.js"></script>
<script src="../../src/tooltip/move.js"></script>
<script src="../../src/tooltip/remove.js"></script>

<script src="../../src/ui/key.js"></script>
<script src="../../src/ui/error.js"></script>
<script src="../../src/ui/titles.js"></script>

<script src="../../src/utils/color.js"></script>
<script src="../../src/utils/utils.js"></script>
<script src="../../src/utils/variables.js"></script>
<script src="../../src/utils/wordwrap.js"></script>

<script src="../../src/zoom/bounds.js"></script>
<script src="../../src/zoom/reset.js"></script>

<script>

  var viz = d3plus.viz()

  d3.json("data/hs_attrs.json", function(attrs) {
    d3.json("data/hs_exports_msr.json", function(data) {
      d3.json("data/hs_network.json", function(network) {
        
        var two = attrs.data.filter(function(a){
          return a.id.length == 2
        })
      
        var six = attrs.data.filter(function(a){
          return a.id.length == 6
        })
      
        two.forEach(function(a){
          a.two = a.id
          delete a.id
        })
      
        data.data.forEach(function(d){
          d.id = d.hs_id
          delete d.hs_id
          d.two = d.id.substr(0,2)
        })
        

        network.edges.forEach(function(link){
          link.source = network.nodes[link.source]
          link.target = network.nodes[link.target]
        })
        
        function rca(d) {
          return d.export_val > 0
        }
      
        viz
          // .dev(true)
          .data(data.data)
          .aggs({"export_rca": "mean"})
          .container("#viz")
          .attrs({"two": two, "id": six})
          .type("network")
          .id(["two","id"])
          .color("color")
          .nodes(network.nodes)
          .links(network.edges)
          .text("name")
          .size("export_val")
          .tooltip(["export_val"])
          .time("year")
          .time({"solo": 2010})
          .title({"total": true})
          .depth(1)
          .active(rca)
          .active({"spotlight": true})
          .draw()
        
      });
    });
  });
  

</script>
</body>
</html>