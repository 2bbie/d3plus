<!DOCTYPE html>
<meta charset="utf-8">
<link href="../src/vizwhiz.css" rel="stylesheet" type="text/css">
<style>

body {
  margin: 0; padding:0;
}

</style>
<body>

<div id="viz"></div>

<script src="../lib/d3.js"></script>
<script src="../lib/modernizr.custom.js"></script>
<script src="../src/general.js"></script>
<script src="../src/utils.js"></script>
<script src="../src/tooltip.js"></script>
<script src="../src/viz/rings.js"></script>

<script>

var viz = vizwhiz.viz.rings()

d3.json("data/attr_cbo.json", function(attr) {
  d3.json("data/network_cbo.json", function(hs) {
    
    viz_nodes = hs.nodes
    viz_links = hs.edges
    // viz_links.forEach(function(link){
    //   link.source = viz_nodes[link.source]
    //   link.target = viz_nodes[link.target]
    // })
    viz_links.forEach(function(link){
      link.source = viz_nodes.filter(function(d){return d.id == link.source})[0]
      link.target = viz_nodes.filter(function(d){return d.id == link.target})[0]
    })
    
    d3.json("data/products_mg.json", function(ps_data) {
      
      ps_data = ps_data.filter(function(d){ return d.year == 2010; })
      data = {} // to pass to viz
      viz_nodes.forEach(function(d){
        data[d.id] = ps_data.filter(function(f){return f.id == d.id})[0]
        data[d.id] = vizwhiz.utils.merge(data[d.id],attr[d.id])
        data[d.id].active = Math.floor(Math.random()*2);
      })

      // viz
      //   .text_var("name")
      //   .id_var("id")
      //   .nodes(viz_nodes)
      //   .links(viz_links)
      //   .value_var("value")
      //   // .center("116108") // women's undergarments
      //   // .center("020910") // ginger
      //   // .center("157202") // ferroalloys
      //   .center("178703") // cars
      //   // .center("168480") // molding boxes
      //   .tooltip_info(["distance", "complexity", "value"])

      viz
        .text_var("name")
        .id_var("id")
        .links(viz_links)
        .value_var("value")
        .center("3762") // Circus
        // .center("1210") // CEOs
        .tooltip_info([])

      d3.select("#viz")
        .datum(data)
        .call(viz)    

    })
  })
})

</script>