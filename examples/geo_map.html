<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link href="../src/vizwhiz.css" rel="stylesheet" type="text/css">
  <style>

  body {
    margin: 0px;
  }

  </style>
</head>
<body>

<div id="viz"></div>

<script src="../lib/d3.js"></script>
<script src="../lib/d3.geo.tile.js"></script>
<script src="../lib/topojson.js"></script>
<script src="../lib/modernizr.custom.js"></script>
<script src="../src/general.js"></script>
<script src="../src/utils.js"></script>
<script src="../src/tooltip.js"></script>
<script src="../src/viz/viz.js"></script>
<script src="../src/viz/geo_map.js"></script>
<script>

  d3.json("data/geo/ap_munic.json", function(shapes) {
    d3.json("data/geo/land.json", function(land) {
      d3.json("data/munic_a0112.json", function(geo_data) {
        d3.json("data/attr_munic.json", function(attr) {
          
          var data = [],
              years = vizwhiz.utils.uniques(geo_data.data,"year")
          years.forEach(function(year){
            for (var d in attr) {
              if (d.substr(0,2) == "ap") {
                var temp = geo_data.data.filter(function(f){return f.year == year && f.bra_id == d})[0]
                var obj = vizwhiz.utils.merge(temp,attr[d])
                obj.year = year
                data.push(obj)
              }
            }
          })
          
          viz = vizwhiz.viz()
            .type("geo_map")
            .coords(shapes)
            .map(land)
            .tiles(false)
            .id_var("id")
            .value_var("wage")
            .text_var("name")
            // .highlight("ap000000")
            .tooltip_info(["id","wage","num_emp","num_est"])
            .total_bar({"prefix": "Export Value: $", "suffix": " USD", "format": ",f"});
          
          d3.select("#viz")
            .datum(data)
            .call(viz);
        
        });
      });
    });
  });
  

</script>
</body>
</html>