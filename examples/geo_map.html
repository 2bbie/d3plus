<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link href="../src/vizwhiz.css" rel="stylesheet" type="text/css">
  <style>

  body {
    margin: 0px;
  }

  </style>
</head>
<body>

<div id="viz"></div>

<script src="../lib/d3.js"></script>
<script src="../lib/d3.geo.tile.js"></script>
<script src="../lib/topojson.js"></script>
<script src="../lib/modernizr.custom.js"></script>
<script src="../src/general.js"></script>
<script src="../src/utils.js"></script>
<script src="../src/tooltip.js"></script>
<script src="../src/viz/geo_map.js"></script>
<script>

  var width = window.innerWidth,
      height = window.innerHeight;
    
  d3.json("data/geo/ap_munic.json", function(shapes) {
    d3.json("data/geo/land.json", function(land) {
      d3.json("data/munic_ap.json", function(geo_data) {
        d3.json("data/attr_munic.json", function(attr) {
        
          var data = geo_data.filter(function(d){ return d.year == 2010; })
          data2010 = {}
          data.forEach(function(d){
            var id = attr[d.id].id_mdic
            data2010[id] = data.filter(function(f){return f.id == d.id})[0]
            data2010[id] = vizwhiz.utils.merge(data2010[id],attr[d.id])
            delete data2010[id].year
            delete data2010[id].attr_type
          })

          var data = geo_data.filter(function(d){ return d.year == 2005; })
          data2005 = {}
          data.forEach(function(d){
            var id = attr[d.id].id_mdic
            data2005[id] = data.filter(function(f){return f.id == d.id})[0]
            data2005[id] = vizwhiz.utils.merge(data2005[id],attr[d.id])
            delete data2005[id].year
            delete data2005[id].attr_type
          })
          
          viz = vizwhiz.viz.geo_map()
            .width(width)
            .height(height)
            .coords(shapes)
            .background(land)
            .id_var("id")
            .value_var("wage")
            .text_var("name")
            .tooltip_info(["wage","num_emp","num_est"]);
          
          d3.select("#viz")
            .datum(data2010)
            .call(viz);
            
          // setTimeout(function(){
          //   console.log("switch")
          //   d3.select("#viz")
          //     .datum(data2005)
          //     .call(viz);
          // },2000)
        
        });
      });
    });
  });
  

</script>
</body>
</html>