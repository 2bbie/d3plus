<!DOCTYPE html>
<meta charset="utf-8">
<link href="../src/vizwhiz.css" rel="stylesheet" type="text/css">
<style>

body {
  margin: 0; padding:0;
}

</style>
<body>

<div id="viz"></div>

<script src="../lib/d3.js"></script>
<script src="../lib/modernizr.custom.js"></script>
<script src="../src/general.js"></script>
<script src="../src/utils.js"></script>
<script src="../src/tooltip.js"></script>
<script src="../src/viz/viz.js"></script>
<script src="../src/viz/pie_scatter.js"></script>

<script>

var viz = vizwhiz.viz()

d3.json("data/rio_branco_test_data.json", function(flat_data){
  d3.json("data/attr_hs.json", function(attrs){
    
    var data = []
    flat_data.data.forEach(function(d, i){
      if (d.hs_id.length == 6) {
        var obj = d
        obj.active = obj.rca >= 1 ? true : false
        obj.nesting_0 = {"name":attrs[obj.hs_id.slice(0, 2)].name, "id":obj.hs_id.slice(0, 2)};
        obj.nesting_1 = {"name":attrs[obj.hs_id.slice(0, 4)].name, "id":obj.hs_id.slice(0, 4)};
        obj.nesting_2 = {"name":attrs[obj.hs_id.slice(0, 6)].name, "id":obj.hs_id.slice(0, 6)};
        obj = vizwhiz.utils.merge(obj, attrs[obj.hs_id]);
        data.push(obj)
      }
    })

    viz
      .type("pie_scatter")
      .text_var("name")
      .id_var("hs_id")
      .xaxis_var("distance")
      .xaxis_domain(d3.extent(data,function(d){return d.distance}))
      .yaxis_var("complexity")
      .yaxis_domain(d3.extent(data,function(d){return d.complexity}).reverse())
      .value_var("val_usd")
      .tooltip_info(["distance", "complexity", "val_usd", "rca"])
      .total_bar({"prefix": "Export Value: $", "suffix": " USD", "format": ",f"})
      .nesting(["nesting_0","nesting_1","nesting_2"])
      .nesting_aggs({"complexity":"mean","distance":"mean","rca":"mean"})
      .solo("Wood Products")
      .depth("nesting_2")
      .spotlight(false)
      .year(2010)

    d3.select("#viz")
      .datum(data)
      .call(viz)   
    
    // setTimeout(function(){
    //   
    //   d3.select("#viz")
    //     .datum(nested2003)
    //     .call(viz)
    //   
    // },2000)
  })
})

</script>