<!DOCTYPE html>
<meta charset="utf-8">
<link href="../src/vizwhiz.css" rel="stylesheet" type="text/css">
<style>

body {
  margin: 0px; padding:0;
}

/*div#viz {
  margin: 0px 50px;
}
*/

</style>
<body>

<div id="viz"></div>

<script src="../lib/d3.js"></script>
<script src="../lib/modernizr.custom.js"></script>
<script src="../src/general.js"></script>
<script src="../src/utils.js"></script>
<script src="../src/tooltip.js"></script>
<script src="../src/viz/viz.js"></script>
<script src="../src/viz/stacked.js"></script>
<script>

d3.json("data/mg_test_data.json", function(flat_data){
  d3.json("data/attr_hs.json", function(attrs){

    flat_data.data.forEach(function(d){
      d.id = d.hs_id
      d.nesting_0 = {"name":attrs[d.id.slice(0, 2)].name, "id":d.id.slice(0, 2)};
      d.nesting_1 = {"name":attrs[d.id.slice(0, 4)].name, "id":d.id.slice(0, 4)};
      d.nesting_2 = {"name":attrs[d.id.slice(0, 6)].name, "id":d.id.slice(0, 6)};
    })
    
    viz = vizwhiz.viz()
      .type("stacked")
      .xaxis_var("year")
      .attrs(attrs)
      .value_var("val_usd")
      .tooltip_info(["id", "complexity", "distance"])
      .text_var("name")
      .id_var("id")
      .total_bar({"prefix": "Export Value: $", "suffix": " USD", "format": ",f"})
      .nesting(["nesting_0","nesting_1","nesting_2"])
      .depth("nesting_2")
    
    d3.select("#viz")
      .datum(flat_data.data)
      .call(viz)
//   
//     setTimeout(function(){
//       d3.select("#viz")
//         .datum({"name":"top", "children": nested_data})
//         .call(viz.text_var("name").id_var("id"))
//     },1000)
//     
  })
})

</script>