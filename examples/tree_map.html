<!DOCTYPE html>
<meta charset="utf-8">
<link href="../src/vizwhiz.css" rel="stylesheet" type="text/css">
<style>

body {
  margin: 0; padding:0;
}

</style>
<body>

<div id="viz"></div>

<script src="../lib/d3.js"></script>
<script src="../lib/modernizr.custom.js"></script>
<script src="../src/general.js"></script>
<script src="../src/utils.js"></script>
<script src="../src/tooltip.js"></script>
<script src="../src/viz/viz.js"></script>
<script src="../src/viz/tree_map.js"></script>
<script>

var viz = vizwhiz.viz()

d3.json("data/products_mg.json", function(raw_data){
  d3.json("data/attr_hs.json", function(attrs){
    
    raw_data.forEach(function(d, i){
      d.nesting_0 = {"name":attrs[d.id.slice(0, 2)].name, "id":d.id.slice(0, 2)};
      d.nesting_1 = {"name":attrs[d.id.slice(0, 4)].name, "id":d.id.slice(0, 4)};
      d.nesting_2 = {"name":attrs[d.id.slice(0, 6)].name, "id":d.id.slice(0, 6)};
      raw_data[i] = vizwhiz.utils.merge(d, attrs[d.id]);
    })
      
    format_nums = function(obj) {
      if (["distance","complexity"].indexOf(obj.name) >= 0) {
        return obj.value.toFixed(2)
      }
      else {
        return obj.value
      }
    }
      
    inner_html = function(obj) {
      console.log(obj)
      return "This is some test HTML"
    }
    
    viz
      .type("tree_map")
      .id_var("id")
      .text_var("name")
      .value_var("val_usd")
      // .tooltip_info({"short": ["val_usd"],"long": ["distance", "complexity", "val_usd"]})
      .tooltip_info(["distance", "complexity", "val_usd"])
      .name_array(["name","id"])
      .title("Product Exports of Minas Gerais")
      .sub_title("Excluding Mineral Products")
      .total_bar({"prefix": "Export Value: $", "suffix": " USD", "format": ",f"})
      .nesting(["nesting_0","nesting_1","nesting_2"])
      .nesting_aggs({"distance":"mean","complexity":"mean"})
      .number_format(format_nums)
      .click_function(inner_html)
      .depth("nesting_0")
      .filter("Mineral Products")
      .year(2010)
      .data_source("Data provided by SECEX")
      
    d3.select("#viz")
      .datum(raw_data)
      .call(viz)
    
    // setTimeout(function(){
    //   
    //   d3.select("#viz").call(viz.year(2005))
    //   
    // },4000)
    
  })
})

</script>